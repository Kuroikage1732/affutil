/*!
 * affutil 0.1.7 (https://github.com/kuroikage1732/affutil#readme)
 * Copyright 2022-2022 Kuroikage1732
 * Licensed under MIT
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):(global="undefined"!=typeof globalThis?globalThis:global||self).affutil=factory()}(this,function(){"use strict";var freeGlobal$1="object"==typeof global&&global&&global.Object===Object&&global,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,freeSelf=freeGlobal$1||freeSelf||Function("return this")(),Symbol$1=freeSelf.Symbol,objectProto$e=Object.prototype,hasOwnProperty$b=objectProto$e.hasOwnProperty,nativeObjectToString$1=objectProto$e.toString,symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;var nativeObjectToString=Object.prototype.toString;var nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(value){return null==value?void 0===value?undefinedTag:nullTag:(symToStringTag&&symToStringTag in Object(value)?function(value){var isOwn=hasOwnProperty$b.call(value,symToStringTag$1),tag=value[symToStringTag$1];try{var unmasked=!(value[symToStringTag$1]=void 0)}catch(e){}var result=nativeObjectToString$1.call(value);return unmasked&&(isOwn?value[symToStringTag$1]=tag:delete value[symToStringTag$1]),result}:function(value){return nativeObjectToString.call(value)})(value)}function isObjectLike(value){return null!=value&&"object"==typeof value}function isSymbol(value){return"symbol"==typeof value||isObjectLike(value)&&"[object Symbol]"==baseGetTag(value)}function arrayMap(array,iteratee){for(var index=-1,length=null==array?0:array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}var isArray$1=Array.isArray,objectProto$e=Symbol$1?Symbol$1.prototype:void 0,symbolToString=objectProto$e?objectProto$e.toString:void 0;function baseToString(value){if("string"==typeof value)return value;if(isArray$1(value))return arrayMap(value,baseToString)+"";if(isSymbol(value))return symbolToString?symbolToString.call(value):"";var result=value+"";return"0"==result&&1/value==-1/0?"-0":result}function isObject(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)}function identity(value){return value}var asyncTag="[object AsyncFunction]",funcTag$2="[object Function]",genTag$1="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(value){if(isObject(value))return value=baseGetTag(value),value==funcTag$2||value==genTag$1||value==asyncTag||value==proxyTag}var objectProto$e=freeSelf["__core-js_shared__"],maskSrcKey=(objectProto$e=/[^.]+$/.exec(objectProto$e&&objectProto$e.keys&&objectProto$e.keys.IE_PROTO||""))?"Symbol(src)_1."+objectProto$e:"";var funcToString$1=Function.prototype.toString;function toSource(func){if(null!=func){try{return funcToString$1.call(func)}catch(e){}try{return func+""}catch(e$1){}}return""}var reIsHostCtor=/^\[object .+?Constructor\]$/,objectProto$e=Function.prototype,objectProto$c=Object.prototype,objectProto$e=objectProto$e.toString,objectProto$c=objectProto$c.hasOwnProperty,reIsNative=RegExp("^"+objectProto$e.call(objectProto$c).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(value){var func;if(isObject(value)&&(func=value,!(maskSrcKey&&maskSrcKey in func)))return(isFunction(value)?reIsNative:reIsHostCtor).test(toSource(value))}function getNative(object,key){object=function(object,key){return null==object?void 0:object[key]}(object,key);return baseIsNative(object)?object:void 0}var objectProto$e=getNative(freeSelf,"WeakMap"),objectCreate=Object.create;function object(){}var baseCreate$1=function(proto){if(!isObject(proto))return{};if(objectCreate)return objectCreate(proto);object.prototype=proto;proto=new object;return object.prototype=void 0,proto};var nativeNow=Date.now;var defineProperty$1=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}();func=defineProperty$1?function(func,string){return defineProperty$1(func,"toString",{configurable:!0,enumerable:!1,value:(value=string,function(){return value}),writable:!0});var value}:identity,lastCalled=count=0;var func,count,lastCalled,setToString$1=function(){var stamp=nativeNow(),remaining=16-(stamp-lastCalled);if(lastCalled=stamp,0<remaining){if(800<=++count)return arguments[0]}else count=0;return func.apply(void 0,arguments)};var MAX_SAFE_INTEGER$1=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(value,length){var type=typeof value;return!!(length=null==length?MAX_SAFE_INTEGER$1:length)&&("number"==type||"symbol"!=type&&reIsUint.test(value))&&-1<value&&value%1==0&&value<length}function baseAssignValue(object,key,value){"__proto__"==key&&defineProperty$1?defineProperty$1(object,key,{configurable:!0,enumerable:!0,value:value,writable:!0}):object[key]=value}function eq(value,other){return value===other||value!=value&&other!=other}var hasOwnProperty$9=Object.prototype.hasOwnProperty;function assignValue(object,key,value){var objValue=object[key];hasOwnProperty$9.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||baseAssignValue(object,key,value)}function copyObject(source,props,object,customizer){for(var isNew=!object,index=(object=object||{},-1),length=props.length;++index<length;){var key=props[index],newValue=customizer?customizer(object[key],source[key],key,object,source):void 0;(isNew?baseAssignValue:assignValue)(object,key,newValue=void 0===newValue?source[key]:newValue)}return object}var nativeMax=Math.max;function overRest(func,start,transform){return start=nativeMax(void 0===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];for(var index=-1,otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),function(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}(func,this,otherArgs)}}var MAX_SAFE_INTEGER=9007199254740991;function isLength(value){return"number"==typeof value&&-1<value&&value%1==0&&value<=MAX_SAFE_INTEGER}function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}function isIterateeCall(value,index,object){var type;if(isObject(object))return type=typeof index,("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object)&&eq(object[index],value)}var objectProto$a=Object.prototype;function isPrototype(value){var Ctor=value&&value.constructor;return value===("function"==typeof Ctor&&Ctor.prototype||objectProto$a)}function baseIsArguments(value){return isObjectLike(value)&&"[object Arguments]"==baseGetTag(value)}var objectProto$c=Object.prototype,hasOwnProperty$8=objectProto$c.hasOwnProperty,propertyIsEnumerable$1=objectProto$c.propertyIsEnumerable,isArguments$1=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty$8.call(value,"callee")&&!propertyIsEnumerable$1.call(value,"callee")};var objectProto$c="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$2=objectProto$c&&"object"==typeof module&&module&&!module.nodeType&&module,freeModule$2=freeModule$2&&freeModule$2.exports===objectProto$c?freeSelf.Buffer:void 0,isBuffer$1=(freeModule$2?freeModule$2.isBuffer:void 0)||function(){return!1},typedArrayTags={};function baseUnary(func){return function(value){return func(value)}}typedArrayTags["[object Float32Array]"]=typedArrayTags["[object Float64Array]"]=typedArrayTags["[object Int8Array]"]=typedArrayTags["[object Int16Array]"]=typedArrayTags["[object Int32Array]"]=typedArrayTags["[object Uint8Array]"]=typedArrayTags["[object Uint8ClampedArray]"]=typedArrayTags["[object Uint16Array]"]=typedArrayTags["[object Uint32Array]"]=!0,typedArrayTags["[object Arguments]"]=typedArrayTags["[object Array]"]=typedArrayTags["[object ArrayBuffer]"]=typedArrayTags["[object Boolean]"]=typedArrayTags["[object DataView]"]=typedArrayTags["[object Date]"]=typedArrayTags["[object Error]"]=typedArrayTags["[object Function]"]=typedArrayTags["[object Map]"]=typedArrayTags["[object Number]"]=typedArrayTags["[object Object]"]=typedArrayTags["[object RegExp]"]=typedArrayTags["[object Set]"]=typedArrayTags["[object String]"]=typedArrayTags["[object WeakMap]"]=!1;var objectProto$c="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule$1=objectProto$c&&"object"==typeof module&&module&&!module.nodeType&&module,freeProcess=freeModule$1&&freeModule$1.exports===objectProto$c&&freeGlobal$1.process,freeModule$2=function(){try{var types=freeModule$1&&freeModule$1.require&&freeModule$1.require("util").types;return types?types:freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}(),objectProto$c=freeModule$2&&freeModule$2.isTypedArray,isTypedArray$1=objectProto$c?baseUnary(objectProto$c):function(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]},hasOwnProperty$7=Object.prototype.hasOwnProperty;function arrayLikeKeys(value,inherited){var key,isArr=isArray$1(value),isArg=!isArr&&isArguments$1(value),isBuff=!isArr&&!isArg&&isBuffer$1(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray$1(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?function(n,iteratee){for(var index=-1,result=Array(n);++index<n;)result[index]=iteratee(index);return result}(value.length,String):[],length=result.length;for(key in value)!inherited&&!hasOwnProperty$7.call(value,key)||skipIndexes&&("length"==key||isBuff&&("offset"==key||"parent"==key)||isType&&("buffer"==key||"byteLength"==key||"byteOffset"==key)||isIndex(key,length))||result.push(key);return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}var nativeKeys$1=overArg(Object.keys,Object),hasOwnProperty$6=Object.prototype.hasOwnProperty;function keys(object){return(isArrayLike(object)?arrayLikeKeys:function(object){if(!isPrototype(object))return nativeKeys$1(object);var key,result=[];for(key in Object(object))hasOwnProperty$6.call(object,key)&&"constructor"!=key&&result.push(key);return result})(object)}var hasOwnProperty$5=Object.prototype.hasOwnProperty;function baseKeysIn(object){if(!isObject(object))return function(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result}(object);var key,isProto=isPrototype(object),result=[];for(key in object)("constructor"!=key||!isProto&&hasOwnProperty$5.call(object,key))&&result.push(key);return result}function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,!0):baseKeysIn(object)}var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(value,object){var type;if(!isArray$1(value))return type=typeof value,"number"==type||"symbol"==type||"boolean"==type||null==value||isSymbol(value)||(reIsPlainProp.test(value)||!reIsDeepProp.test(value)||null!=object&&value in Object(object))}var nativeCreate$1=getNative(Object,"create");var hasOwnProperty$4=Object.prototype.hasOwnProperty;var hasOwnProperty$3=Object.prototype.hasOwnProperty;function Hash(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}function assocIndexOf(array,key){for(var length=array.length;length--;)if(eq(array[length][0],key))return length;return-1}Hash.prototype.clear=function(){this.__data__=nativeCreate$1?nativeCreate$1(null):{},this.size=0},Hash.prototype.delete=function(key){return key=this.has(key)&&delete this.__data__[key],this.size-=key?1:0,key},Hash.prototype.get=function(key){var result,data=this.__data__;return nativeCreate$1?"__lodash_hash_undefined__"===(result=data[key])?void 0:result:hasOwnProperty$4.call(data,key)?data[key]:void 0},Hash.prototype.has=function(key){var data=this.__data__;return nativeCreate$1?void 0!==data[key]:hasOwnProperty$3.call(data,key)},Hash.prototype.set=function(key,value){var data=this.__data__;return this.size+=this.has(key)?0:1,data[key]=nativeCreate$1&&void 0===value?"__lodash_hash_undefined__":value,this};var splice=Array.prototype.splice;function ListCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}ListCache.prototype.clear=function(){this.__data__=[],this.size=0},ListCache.prototype.delete=function(key){var data=this.__data__;return!((key=assocIndexOf(data,key))<0)&&(key==data.length-1?data.pop():splice.call(data,key,1),--this.size,!0)},ListCache.prototype.get=function(key){var data=this.__data__;return(key=assocIndexOf(data,key))<0?void 0:data[key][1]},ListCache.prototype.has=function(key){return-1<assocIndexOf(this.__data__,key)},ListCache.prototype.set=function(key,value){var data=this.__data__,index=assocIndexOf(data,key);return index<0?(++this.size,data.push([key,value])):data[index][1]=value,this};var Map$1=getNative(freeSelf,"Map");function getMapData(map,key){var value,type,map=map.__data__;return("string"==(type=typeof(value=key))||"number"==type||"symbol"==type||"boolean"==type?"__proto__"!==value:null===value)?map["string"==typeof key?"string":"hash"]:map.map}function MapCache(entries){var index=-1,length=null==entries?0:entries.length;for(this.clear();++index<length;){var entry=entries[index];this.set(entry[0],entry[1])}}MapCache.prototype.clear=function(){this.size=0,this.__data__={hash:new Hash,map:new(Map$1||ListCache),string:new Hash}},MapCache.prototype.delete=function(key){return key=getMapData(this,key).delete(key),this.size-=key?1:0,key},MapCache.prototype.get=function(key){return getMapData(this,key).get(key)},MapCache.prototype.has=function(key){return getMapData(this,key).has(key)},MapCache.prototype.set=function(key,value){var data=getMapData(this,key),size=data.size;return data.set(key,value),this.size+=data.size==size?0:1,this};function memoize(func,resolver){if("function"!=typeof func||null!=resolver&&"function"!=typeof resolver)throw new TypeError("Expected a function");function memoized(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;return cache.has(key)?cache.get(key):(args=func.apply(this,args),memoized.cache=cache.set(key,args)||cache,args)}return memoized.cache=new(memoize.Cache||MapCache),memoized}memoize.Cache=MapCache;var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=function(func){var cache=(func=memoize(func,function(key){return 500===cache.size&&cache.clear(),key})).cache;return func}(function(string){var result=[];return 46===string.charCodeAt(0)&&result.push(""),string.replace(rePropName,function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)}),result});function castPath(value,object){return isArray$1(value)?value:isKey(value,object)?[value]:stringToPath$1(function(value){return null==value?"":baseToString(value)}(value))}var INFINITY=1/0;function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}function baseGet(object,path){for(var index=0,length=(path=castPath(path,object)).length;null!=object&&index<length;)object=object[toKey(path[index++])];return index&&index==length?object:void 0}function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}var spreadableSymbol=Symbol$1?Symbol$1.isConcatSpreadable:void 0;function isFlattenable(value){return isArray$1(value)||isArguments$1(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}var getPrototype$1=overArg(Object.getPrototypeOf,Object);function Stack(entries){entries=this.__data__=new ListCache(entries);this.size=entries.size}Stack.prototype.clear=function(){this.__data__=new ListCache,this.size=0},Stack.prototype.delete=function(key){var data=this.__data__,key=data.delete(key);return this.size=data.size,key},Stack.prototype.get=function(key){return this.__data__.get(key)},Stack.prototype.has=function(key){return this.__data__.has(key)},Stack.prototype.set=function(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map$1||pairs.length<199)return pairs.push([key,value]),this.size=++data.size,this;data=this.__data__=new MapCache(pairs)}return data.set(key,value),this.size=data.size,this};var freeGlobal$1="object"==typeof exports&&exports&&!exports.nodeType&&exports,objectProto$c=freeGlobal$1&&"object"==typeof module&&module&&!module.nodeType&&module,objectProto$c=objectProto$c&&objectProto$c.exports===freeGlobal$1?freeSelf.Buffer:void 0,allocUnsafe=objectProto$c?objectProto$c.allocUnsafe:void 0;function stubArray(){return[]}var propertyIsEnumerable=Object.prototype.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols$1=nativeGetSymbols$1?function(object){if(null==object)return[];object=Object(object);for(var array=nativeGetSymbols$1(object),predicate=function(symbol){return propertyIsEnumerable.call(object,symbol)},index=-1,length=null==array?0:array.length,resIndex=0,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[resIndex++]=value)}return result}:stubArray;var getSymbolsIn$1=Object.getOwnPropertySymbols?function(object){for(var result=[];object;)arrayPush(result,getSymbols$1(object)),object=getPrototype$1(object);return result}:stubArray;function baseGetAllKeys(object,keysFunc,symbolsFunc){keysFunc=keysFunc(object);return isArray$1(object)?keysFunc:arrayPush(keysFunc,symbolsFunc(object))}function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols$1)}function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn$1)}var freeGlobal$1=getNative(freeSelf,"DataView"),objectProto$c=getNative(freeSelf,"Promise"),Set$1=getNative(freeSelf,"Set"),dataViewCtorString=toSource(freeGlobal$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(objectProto$c),setCtorString=toSource(Set$1),weakMapCtorString=toSource(objectProto$e),getTag=baseGetTag,getTag$1=getTag=freeGlobal$1&&"[object DataView]"!=getTag(new freeGlobal$1(new ArrayBuffer(1)))||Map$1&&"[object Map]"!=getTag(new Map$1)||objectProto$c&&"[object Promise]"!=getTag(objectProto$c.resolve())||Set$1&&"[object Set]"!=getTag(new Set$1)||objectProto$e&&"[object WeakMap]"!=getTag(new objectProto$e)?function(value){var result=baseGetTag(value),value="[object Object]"==result?value.constructor:void 0,value=value?toSource(value):"";if(value)switch(value){case dataViewCtorString:return"[object DataView]";case mapCtorString:return"[object Map]";case promiseCtorString:return"[object Promise]";case setCtorString:return"[object Set]";case weakMapCtorString:return"[object WeakMap]"}return result}:getTag,hasOwnProperty$2=Object.prototype.hasOwnProperty;var Uint8Array$1=freeSelf.Uint8Array;function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);return new Uint8Array$1(result).set(new Uint8Array$1(arrayBuffer)),result}var reFlags=/\w*$/;var freeGlobal$1=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf$1=freeGlobal$1?freeGlobal$1.valueOf:void 0;var boolTag$2="[object Boolean]",dateTag$2="[object Date]",mapTag$3="[object Map]",numberTag$2="[object Number]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$2="[object String]",symbolTag$2="[object Symbol]",arrayBufferTag$2="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag$1="[object Float32Array]",float64Tag$1="[object Float64Array]",int8Tag$1="[object Int8Array]",int16Tag$1="[object Int16Array]",int32Tag$1="[object Int32Array]",uint8Tag$1="[object Uint8Array]",uint8ClampedTag$1="[object Uint8ClampedArray]",uint16Tag$1="[object Uint16Array]",uint32Tag$1="[object Uint32Array]";function initCloneByTag(object,tag,isDeep){var regexp,result,Ctor=object.constructor;switch(tag){case arrayBufferTag$2:return cloneArrayBuffer(object);case boolTag$2:case dateTag$2:return new Ctor(+object);case dataViewTag$2:return function(dataView,isDeep){return isDeep=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer,new dataView.constructor(isDeep,dataView.byteOffset,dataView.byteLength)}(object,isDeep);case float32Tag$1:case float64Tag$1:case int8Tag$1:case int16Tag$1:case int32Tag$1:case uint8Tag$1:case uint8ClampedTag$1:case uint16Tag$1:case uint32Tag$1:return function(typedArray,isDeep){return isDeep=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer,new typedArray.constructor(isDeep,typedArray.byteOffset,typedArray.length)}(object,isDeep);case mapTag$3:return new Ctor;case numberTag$2:case stringTag$2:return new Ctor(object);case regexpTag$2:return(result=new(regexp=object).constructor(regexp.source,reFlags.exec(regexp))).lastIndex=regexp.lastIndex,result;case setTag$3:return new Ctor;case symbolTag$2:return regexp=object,symbolValueOf$1?Object(symbolValueOf$1.call(regexp)):{}}}var objectProto$c=freeModule$2&&freeModule$2.isMap,isMap$1=objectProto$c?baseUnary(objectProto$c):function(value){return isObjectLike(value)&&"[object Map]"==getTag$1(value)};var Set$1=freeModule$2&&freeModule$2.isSet,isSet$1=Set$1?baseUnary(Set$1):function(value){return isObjectLike(value)&&"[object Set]"==getTag$1(value)},CLONE_DEEP_FLAG$1=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG$1=4,argsTag$1="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",objectTag$1="[object Object]",cloneableTags={};function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG$1,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG$1;if(void 0!==(result=customizer?object?customizer(value,key,object,stack):customizer(value):result))return result;if(!isObject(value))return value;key=isArray$1(value);if(key){if(result=function(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty$2.call(array,"index")&&(result.index=array.index,result.input=array.input),result}(value),!isDeep){var source=value,array=result,index=-1,length=source.length;for(array=array||Array(length);++index<length;)array[index]=source[index];return array}}else{var tag=getTag$1(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer$1(value))return function(buffer,isDeep){return isDeep?buffer.slice():(isDeep=buffer.length,isDeep=allocUnsafe?allocUnsafe(isDeep):new buffer.constructor(isDeep),buffer.copy(isDeep),isDeep)}(value,isDeep);if(tag==objectTag$1||tag==argsTag$1||isFunc&&!object){if(result=isFlat||isFunc?{}:function(object){return"function"!=typeof object.constructor||isPrototype(object)?{}:baseCreate$1(getPrototype$1(object))}(value),!isDeep)return isFlat?function(source,object){return copyObject(source,getSymbolsIn$1(source),object)}(value,function(object,source){return object&&copyObject(source,keysIn(source),object)}(result,value)):function(source,object){return copyObject(source,getSymbols$1(source),object)}(value,function(object,source){return object&&copyObject(source,keys(source),object)}(result,value))}else{if(!cloneableTags[tag])return object?value:{};result=initCloneByTag(value,tag,isDeep)}}isFunc=(stack=stack||new Stack).get(value);if(isFunc)return isFunc;stack.set(value,result),isSet$1(value)?value.forEach(function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))}):isMap$1(value)&&value.forEach(function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))});var props=key?void 0:(isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys)(value);return function(array,iteratee){for(var index=-1,length=null==array?0:array.length;++index<length&&!1!==iteratee(array[index],index,array););}(props||value,function(subValue,key){props&&(subValue=value[key=subValue]),assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))}),result}cloneableTags[argsTag$1]=cloneableTags["[object Array]"]=cloneableTags["[object ArrayBuffer]"]=cloneableTags["[object DataView]"]=cloneableTags["[object Boolean]"]=cloneableTags["[object Date]"]=cloneableTags["[object Float32Array]"]=cloneableTags["[object Float64Array]"]=cloneableTags["[object Int8Array]"]=cloneableTags["[object Int16Array]"]=cloneableTags["[object Int32Array]"]=cloneableTags["[object Map]"]=cloneableTags["[object Number]"]=cloneableTags[objectTag$1]=cloneableTags["[object RegExp]"]=cloneableTags["[object Set]"]=cloneableTags["[object String]"]=cloneableTags["[object Symbol]"]=cloneableTags["[object Uint8Array]"]=cloneableTags["[object Uint8ClampedArray]"]=cloneableTags["[object Uint16Array]"]=cloneableTags["[object Uint32Array]"]=!0,cloneableTags["[object Error]"]=cloneableTags[funcTag]=cloneableTags["[object WeakMap]"]=!1;function cloneDeep(value){return baseClone(value,5)}function SetCache(values){var index=-1,length=null==values?0:values.length;for(this.__data__=new MapCache;++index<length;)this.add(values[index])}SetCache.prototype.add=SetCache.prototype.push=function(value){return this.__data__.set(value,"__lodash_hash_undefined__"),this},SetCache.prototype.has=function(value){return this.__data__.has(value)};function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&arrLength<othLength))return!1;var othLength=stack.get(array),othStacked=stack.get(other);if(othLength&&othStacked)return othLength==other&&othStacked==array;var index=-1,result=!0,seen=2&bitmask?new SetCache:void 0;for(stack.set(array,other),stack.set(other,array);++index<arrLength;){var compared,arrValue=array[index],othValue=other[index];if(void 0!==(compared=customizer?isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack):compared)){if(compared)continue;result=!1;break}if(seen){if(!function(array,predicate){for(var index=-1,length=null==array?0:array.length;++index<length;)if(predicate(array[index],index,array))return 1}(other,function(othValue,othIndex){return!seen.has(othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))&&seen.push(othIndex)})){result=!1;break}}else if(arrValue!==othValue&&!equalFunc(arrValue,othValue,bitmask,customizer,stack)){result=!1;break}}return stack.delete(array),stack.delete(other),result}function mapToArray(map){var index=-1,result=Array(map.size);return map.forEach(function(value,key){result[++index]=[key,value]}),result}function setToArray(set){var index=-1,result=Array(set.size);return set.forEach(function(value){result[++index]=value}),result}var objectProto$e=Symbol$1?Symbol$1.prototype:void 0,symbolValueOf=objectProto$e?objectProto$e.valueOf:void 0;var hasOwnProperty$1=Object.prototype.hasOwnProperty;var objectTag="[object Object]",hasOwnProperty=Object.prototype.hasOwnProperty;function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray$1(object),othIsArr=isArray$1(other),objTag=objIsArr?"[object Array]":getTag$1(object),othIsArr=othIsArr?"[object Array]":getTag$1(other),objIsObj=(objTag="[object Arguments]"==objTag?objectTag:objTag)==objectTag,othIsObj=(othIsArr="[object Arguments]"==othIsArr?objectTag:othIsArr)==objectTag,othIsArr=objTag==othIsArr;if(othIsArr&&isBuffer$1(object)){if(!isBuffer$1(other))return!1;objIsObj=!(objIsArr=!0)}if(othIsArr&&!objIsObj)return stack=stack||new Stack,objIsArr||isTypedArray$1(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):function(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case"[object DataView]":if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset)return!1;object=object.buffer,other=other.buffer;case"[object ArrayBuffer]":return object.byteLength==other.byteLength&&equalFunc(new Uint8Array$1(object),new Uint8Array$1(other))?!0:!1;case"[object Boolean]":case"[object Date]":case"[object Number]":return eq(+object,+other);case"[object Error]":return object.name==other.name&&object.message==other.message;case"[object RegExp]":case"[object String]":return object==other+"";case"[object Map]":var convert=mapToArray;case"[object Set]":convert=convert||setToArray;if(object.size!=other.size&&!(1&bitmask))return!1;var stacked=stack.get(object);if(stacked)return stacked==other;bitmask|=2,stack.set(object,other);stacked=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);return stack.delete(object),stacked;case"[object Symbol]":if(symbolValueOf)return symbolValueOf.call(object)==symbolValueOf.call(other)}return!1}(object,other,objTag,bitmask,customizer,equalFunc,stack);if(!(1&bitmask)){objIsArr=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),objTag=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsArr||objTag)return equalFunc(objIsArr?object.value():object,objTag?other.value():other,bitmask,customizer,stack=stack||new Stack)}return!!othIsArr&&function(object,other,bitmask,customizer,equalFunc,stack){var isPartial=1&bitmask,objProps=getAllKeys(object),objLength=objProps.length;if(objLength!=getAllKeys(other).length&&!isPartial)return!1;for(var index=objLength;index--;){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty$1.call(other,key)))return!1}var objStacked=stack.get(object),othStacked=stack.get(other);if(objStacked&&othStacked)return objStacked==other&&othStacked==object;for(var result=!0,skipCtor=(stack.set(object,other),stack.set(other,object),isPartial);++index<objLength;){var compared,objValue=object[key=objProps[index]],othValue=other[key];if(!(void 0===(compared=customizer?isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack):compared)?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=!1;break}skipCtor=skipCtor||"constructor"==key}return result&&!skipCtor&&(objStacked=object.constructor)!=(othStacked=other.constructor)&&"constructor"in object&&"constructor"in other&&!("function"==typeof objStacked&&objStacked instanceof objStacked&&"function"==typeof othStacked&&othStacked instanceof othStacked)&&(result=!1),stack.delete(object),stack.delete(other),result}(object,other,bitmask,customizer,equalFunc,stack=stack||new Stack)}function baseIsEqual(value,other,bitmask,customizer,stack){return value===other||(null==value||null==other||!isObjectLike(value)&&!isObjectLike(other)?value!=value&&other!=other:baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack))}function isStrictComparable(value){return value==value&&!isObject(value)}function matchesStrictComparable(key,srcValue){return function(object){return null!=object&&(object[key]===srcValue&&(void 0!==srcValue||key in Object(object)))}}function baseMatches(source){var matchData=function(object){for(var result=keys(object),length=result.length;length--;){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}(source);return 1==matchData.length&&matchData[0][2]?matchesStrictComparable(matchData[0][0],matchData[0][1]):function(object){return object===source||function(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(null==object)return!length;for(object=Object(object);index--;){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object))return!1}for(;++index<length;){var key=(data=matchData[index])[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(void 0===objValue&&!(key in object))return!1}else{var result,stack=new Stack;if(!(void 0===(result=customizer?customizer(objValue,srcValue,key,object,source,stack):result)?baseIsEqual(srcValue,objValue,3,customizer,stack):result))return!1}}return!0}(object,source,matchData)}}function baseHasIn(object,key){return null!=object&&key in Object(object)}function hasIn(object,path){return null!=object&&function(object,path,hasFunc){for(var index=-1,length=(path=castPath(path,object)).length,result=!1;++index<length;){var key=toKey(path[index]);if(!(result=null!=object&&hasFunc(object,key)))break;object=object[key]}return result||++index!=length?result:!!(length=null==object?0:object.length)&&isLength(length)&&isIndex(key,length)&&(isArray$1(object)||isArguments$1(object))}(object,path,baseHasIn)}var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty(path,srcValue){return isKey(path)&&isStrictComparable(srcValue)?matchesStrictComparable(toKey(path),srcValue):function(object){var objValue=function(object,path,defaultValue){return void 0===(object=null==object?void 0:baseGet(object,path))?defaultValue:object}(object,path);return void 0===objValue&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}function property(path){return isKey(path)?(key=toKey(path),function(object){return null==object?void 0:object[key]}):function(path){return function(object){return baseGet(object,path)}}(path);var key}function baseIteratee(value){return"function"==typeof value?value:null==value?identity:"object"==typeof value?isArray$1(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value):property(value)}var fromRight,baseFor$1=function(object,iteratee,keysFunc){for(var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;length--;){var key=props[fromRight?length:++index];if(!1===iteratee(iterable[key],key,iterable))break}return object};var baseEach$1=function(eachFunc,fromRight){return function(collection,iteratee){if(null==collection)return collection;if(!isArrayLike(collection))return eachFunc(collection,iteratee);for(var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);(fromRight?index--:++index<length)&&!1!==iteratee(iterable[index],index,iterable););return collection}}(function(object,iteratee){return object&&baseFor$1(object,iteratee,keys)});function compareMultiple(object,other,orders){for(var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;++index<length;){var result=function(value,other){if(value!==other){var valIsDefined=void 0!==value,valIsNull=null===value,valIsReflexive=value==value,valIsSymbol=isSymbol(value),othIsDefined=void 0!==other,othIsNull=null===other,othIsReflexive=other==other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&other<value||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive)return 1;if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive)return-1}return 0}(objCriteria[index],othCriteria[index]);if(result)return ordersLength<=index?result:result*("desc"==orders[index]?-1:1)}return object.index-other.index}function baseOrderBy(collection,iteratees,orders){iteratees=iteratees.length?arrayMap(iteratees,function(iteratee){return isArray$1(iteratee)?function(value){return baseGet(value,1===iteratee.length?iteratee[0]:iteratee)}:iteratee}):[identity];var index=-1;iteratees=arrayMap(iteratees,baseUnary(baseIteratee));var array=function(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach$1(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}(collection,function(value,key,collection){return{criteria:arrayMap(iteratees,function(iteratee){return iteratee(value)}),index:++index,value:value}}),collection=function(object,other){return compareMultiple(object,other,orders)},length=array.length;for(array.sort(collection);length--;)array[length]=array[length].value;return array}var sortBy$1=function(func,start){return setToString$1(overRest(func,start,identity),func+"")}(function(collection,iteratees){if(null==collection)return[];var length=iteratees.length;return 1<length&&isIterateeCall(collection,iteratees[0],iteratees[1])?iteratees=[]:2<length&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])&&(iteratees=[iteratees[0]]),baseOrderBy(collection,function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate=predicate||isFlattenable,result=result||[];++index<length;){var value=array[index];0<depth&&predicate(value)?1<depth?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}(iteratees,1),[])});function timeAlign(time,bpm,error,lcm){void 0===error&&(error=3);var bpm=24e4/bpm/(lcm=void 0===lcm?96:lcm),lcm=0,atime1=Math.round(Math.floor(time/bpm)*bpm),bpm=Math.round(Math.ceil(time/bpm)*bpm),abs1=Math.abs(time-atime1),abs2=Math.abs(time-bpm),ok1=abs1<=error,error=abs2<=error,lcm=(ok1=ok1&&error&&abs2<abs1?!1:ok1)?atime1:error?bpm:time;return Math.floor(lcm)}function Note(time){this.time=Math.floor(time)}var getTag={type:{configurable:!0}},NoteGroup=(getTag.type.get=function(){return this.constructor.name},Note.prototype.moveto=function(dest){return this.time=Math.floor(dest),this},Note.prototype.copy=function(){return cloneDeep(this)},Note.prototype.mirror=function(){return this},Note.prototype.offsetto=function(value){return this.time=Math.floor(this.time+value),this},Note.prototype.align=function(bpm,error,lcm){return this.time=timeAlign(this.time,bpm,error=void 0===error?3:error,lcm=void 0===lcm?96:lcm),this},Object.defineProperties(Note.prototype,getTag),function(Array){function NoteGroup(notes){var this$1$1=this;void 0===notes&&(notes=[]),Array.call(this),notes&&notes.forEach(function(value){value instanceof Array&&"TimingGroup"!=value.type?this$1$1.concat(value):this$1$1.push(value)})}Array&&(NoteGroup.__proto__=Array),(NoteGroup.prototype=Object.create(Array&&Array.prototype)).constructor=NoteGroup;var prototypeAccessors$1={type:{configurable:!0}};return prototypeAccessors$1.type.get=function(){return this.constructor.name},NoteGroup.prototype.toString=function(){var str="";return this.forEach(function(value,index,arr){value&&(str+=value.toString()),index<arr.length-1&&(str+="\n")}),str},NoteGroup.prototype.push=function(){for(var this$1$1=this,objs=[],len=arguments.length;len--;)objs[len]=arguments[len];return objs.forEach(function(obj){Array.prototype.push.call(this$1$1,obj)}),this.length},NoteGroup.prototype.concat=function(){for(var this$1$1=this,iterables=[],len=arguments.length;len--;)iterables[len]=arguments[len];return iterables.forEach(function(iter){iter instanceof NoteGroup?Array.prototype.concat.call(this$1$1,iter):iter.forEach(function(item){this$1$1.push(item)})}),this},NoteGroup.prototype.moveto=function(dest){var this$1$1=this;return this.forEach(function(value,index){value&&this$1$1[index].moveto(dest)}),this},NoteGroup.prototype.mirror=function(){var this$1$1=this;return this.forEach(function(value,index){value&&this$1$1[index].mirror()}),this},NoteGroup.prototype.align=function(bpm,error,lcm){var this$1$1=this;return void 0===error&&(error=3),void 0===lcm&&(lcm=96),this.forEach(function(value,index){value&&this$1$1[index].align(bpm,error,lcm)}),this},Object.defineProperties(NoteGroup.prototype,prototypeAccessors$1),NoteGroup}(Array)),Tap=function(Note){function Tap(time,lane){Note.call(this,time),this.lane=lane}Note&&(Tap.__proto__=Note),(Tap.prototype=Object.create(Note&&Note.prototype)).constructor=Tap;var prototypeAccessors={lane:{configurable:!0}};return prototypeAccessors.lane.set=function(lane){if(!(lane==Math.floor(lane)&&0<lane&&lane<5))throw"invalid value "+lane+' for attribute "lane" (only accept 1~4)';this._lane=lane},prototypeAccessors.lane.get=function(){return this._lane},Tap.prototype.toString=function(){return"("+Math.floor(this.time)+","+this._lane+");"},Tap.prototype.mirror=function(){return this._lane=5-this._lane,this},Object.defineProperties(Tap.prototype,prototypeAccessors),Tap}(Note),Hold=function(Tap){function Hold(time,totime,lane){Tap.call(this,time,lane),this.totime=Math.floor(totime)}Tap&&(Hold.__proto__=Tap),(Hold.prototype=Object.create(Tap&&Tap.prototype)).constructor=Hold;var prototypeAccessors={length:{configurable:!0}};return prototypeAccessors.length.get=function(){return Math.floor(this.totime-this.time)},Hold.prototype.toString=function(){return"hold("+Math.floor(this.time)+","+Math.floor(this.totime)+","+this._lane+");"},Hold.prototype.moveto=function(dest){var time=this.time;return Tap.prototype.moveto.call(this,dest),this.totime+=this.time-time,this},Hold.prototype.copyto=function(dest){return this.copy().moveto(dest)},Hold.prototype.offsetto=function(value){return Tap.prototype.offsetto.call(this,value),this.totime+=value,this},Hold.prototype.align=function(bpm,error,lcm){return Tap.prototype.align.call(this,bpm,error=void 0===error?3:error,lcm=void 0===lcm?96:lcm),this.totime=timeAlign(this.totime,bpm,error,lcm),this.time==this.totime&&(this.totime+=1),this},Object.defineProperties(Hold.prototype,prototypeAccessors),Hold}(Tap),validstrings={slideeasinglist:["b","s","si","so","sisi","soso","sosi","siso"],slideeasingexlist:["bb","sb","sib","sob","bs","ss","sis","sos","bsi","ssi","bso","sso"],fxlist:["full","incremental"],cameraeasinglist:["qi","qo","l","reset","s"],scenetypelist:["trackshow","trackhide","redline","arcahvdistort","arcahvdebris","hidegroup"]};function bezier(percent,p1x,p1y,p2x,p2y){var cx=3*(p1x=void 0===p1x?1/3:p1x),bx=3*((p2x=void 0===p2x?2/3:p2x)-p1x)-cx,ax=1-cx-bx,p2x=3*(p1y=void 0===p1y?0:p1y),p1x=3*((p2y=void 0===p2y?1:p2y)-p1y)-p2x,p2y=1-p2x-p1x;p1y=function(x){for(var t2=x,i=0;i<8;i++){var x2=((ax*t2+bx)*t2+cx)*t2-x;if(Math.abs(x2)<1e-6)return t2;var d2=(3*ax*t2+2*bx)*t2+cx;if(Math.abs(d2)<1e-6)break;t2-=x2/d2}var t0=0,t1=1;if((t2=x)<t0)return t0;if(t1<t2)return t1;for(;t0<t1;){var x2$1=((ax*t2+bx)*t2+cx)*t2;if(Math.abs(x2$1-x)<1e-6)return t2;x2$1<x?t0=t2:t1=t2,t2=.5*(t1-t0)+t0}return t2}(percent);return((p2y*p1y+p1x)*p1y+p2x)*p1y}function slicer(time,fromtime,totime,fromposition,toposition,easingtype){return time-=fromtime,totime-=fromtime,toposition-=fromposition,(easingtype=void 0===easingtype?"s":easingtype)instanceof Function?toposition*easingtype(time/totime)+fromposition:"si"==easingtype?toposition*(fromtime=time/totime,Math.sin(fromtime*(Math.PI/2)))+fromposition:"so"==easingtype?toposition*function(percent){return Math.cos(percent*(Math.PI/2)+Math.PI)+1}(time/totime)+fromposition:"b"==easingtype?toposition*bezier(time/totime)+fromposition:toposition*(time/totime)+fromposition}var Arc=function(Hold){function Arc(time,totime,fromx,tox,slideeasing,fromy,toy,color,isskyline,skynote,fx){void 0===skynote&&(skynote=[]),void 0===fx&&(fx="none"),Hold.call(this,time,totime,1),this.fromx=fromx,this.fromy=fromy,this.tox=tox,this.toy=toy,this.slideeasing=slideeasing,this.color=color,this.isskyline=isskyline,this.skynote=skynote,this.fx=fx}Hold&&(Arc.__proto__=Hold),(Arc.prototype=Object.create(Hold&&Hold.prototype)).constructor=Arc;var prototypeAccessors={skynote:{configurable:!0},color:{configurable:!0},slideeasing:{configurable:!0},fx:{configurable:!0}};return prototypeAccessors.skynote.set=function(times){times&&(this._skynote=cloneDeep(times),this._skynote.sort())},prototypeAccessors.skynote.get=function(){return this._skynote},prototypeAccessors.color.set=function(value){if(!(0<=value))throw"invalid value "+value+' for attribute "color" (only accept >=0)';this._color=value},prototypeAccessors.color.get=function(){return this._color},prototypeAccessors.slideeasing.set=function(easingtype){if(easingtype instanceof Array)for(var valid=["b","s","si","so"],i=0;i<2&&!(easingtype[i]instanceof Function);i++){var et=easingtype[i];if(-1==valid.indexOf(et))throw"invalid value "+easingtype[i]+' for attribute "slideeasing" (only accept '+valid+")"}else if(!(easingtype instanceof Function)&&-1==validstrings.slideeasinglist.indexOf(easingtype))throw"invalid value "+easingtype+' for attribute "slideeasing" (only accept '+validstrings.slideeasinglist+")";this._slideeasing=easingtype},prototypeAccessors.slideeasing.get=function(){return this._slideeasing},prototypeAccessors.fx.set=function(value){if("none"!=value&&-1==validstrings.fxlist.indexOf(value))throw"invalid value "+value+' for attribute "fx" (only accept '+validstrings.fxlist+")";this._fx=value},prototypeAccessors.fx.get=function(){return this._fx},Arc.prototype.__geteasingtype=function(){var x_type,y_type,se=this.slideeasing;return se instanceof Function?y_type=x_type=se:se instanceof Array?(x_type=se[0],y_type=se[1]):(y_type=x_type="s",se.length<3&&-1==["bb","bs","sb","ss"].indexOf(se)?"b"==(x_type=se)&&(y_type="b"):(se.startsWith("b")?x_type="b":se.startsWith("si")?x_type="si":se.startsWith("so")&&(x_type="so"),se.endsWith("b")?y_type="b":se.endsWith("si")?y_type="si":se.endsWith("so")&&(y_type="so"))),[x_type,y_type]},Arc.prototype.get=function(item){var easingtype=this.__geteasingtype();return[slicer(item,this.time,this.totime,this.fromx,this.tox,easingtype[0]),slicer(item,this.time,this.totime,this.fromy,this.toy,easingtype[1])]},Arc.prototype.toString=function(){var arcstr="arc("+this.time+","+this.totime+","+this.fromx.toFixed(2)+","+this.tox.toFixed(2)+","+this._slideeasing+","+this.fromy.toFixed(2)+","+this.toy.toFixed(2)+","+this._color+","+this._fx+","+this.isskyline+")",skynotestr="";if(0<this._skynote.length)for(var index=0;index<this._skynote.length;index++)skynotestr+="arctap("+this._skynote[index]+")",index!=this._skynote.length-1&&(skynotestr+=",");return arcstr+(""==skynotestr?"":"["+skynotestr+"]")+";"},Arc.prototype.moveto=function(dest){for(var offset=dest-this.time,index=0;index<this._skynote.length;index++)this._skynote[index]+=offset;return this},Arc.prototype.mirror=function(){return this.fromx=1-this.fromx,this.tox=1-this.tox,this},Arc.prototype.vmirror=function(){return this.fromy=1-this.fromy,this.toy=1-this.toy,this},Arc.prototype.offsetto=function(value){var this$1$1=this;return Hold.prototype.offsetto.call(this,value),this._skynote&&this._skynote.forEach(function(v,index){this$1$1._skynote[index]+=value}),this},Arc.prototype.align=function(bpm,error,lcm){var this$1$1=this;return void 0===error&&(error=3),void 0===lcm&&(lcm=96),Hold.prototype.align.call(this,bpm,error,lcm),this._skynote&&this._skynote.forEach(function(value,index){this$1$1._skynote[index]=timeAlign(value,bpm,error,lcm)}),this},Arc.prototype.transfer=function(xValue,yValue){return this.fromx+=xValue,this.tox+=xValue,this.fromy+=yValue,this.toy+=yValue,this},Object.defineProperties(Arc.prototype,prototypeAccessors),Arc}(Hold),Timing=function(Note){function Timing(time,bpm,bar){void 0===bar&&(bar=4),Note.call(this,time),this.bpm=bpm,this.bar=bar}return Note&&(Timing.__proto__=Note),((Timing.prototype=Object.create(Note&&Note.prototype)).constructor=Timing).prototype.toString=function(){return"timing("+this.time+","+this.bpm.toFixed(2)+","+this.bar.toFixed(2)+");"},Timing}(Note),SceneControl=function(Note){function SceneControl(time,scenetype,x,y){void 0===x&&(x=0),void 0===y&&(y=0),Note.call(this,time),this.scenetype=scenetype,this.x=x,this.y=y}Note&&(SceneControl.__proto__=Note),(SceneControl.prototype=Object.create(Note&&Note.prototype)).constructor=SceneControl;var prototypeAccessors={scenetype:{configurable:!0}};return prototypeAccessors.scenetype.set=function(type){if(-1==validstrings.scenetypelist.indexOf(type))throw type+" is not a valid scene type";this._scenetype=type},prototypeAccessors.scenetype.get=function(){return this._scenetype},SceneControl.prototype.toString=function(){if(-1!=["trackshow","trackhide"].indexOf(this._scenetype))return"scenecontrol("+Math.floor(this.time)+","+this._scenetype+");";if(-1!=["redline","arcahvdistort","arcahvdebris","hidegroup"].indexOf(this._scenetype))return"scenecontrol("+Math.floor(this.time)+","+this._scenetype+","+this.x.toFixed(2)+","+this.y+");";throw this._scenetype+" is not a valid scene type"},Object.defineProperties(SceneControl.prototype,prototypeAccessors),SceneControl}(Note),Camera=function(Note){function Camera(time,transverse,bottomzoom,linezoom,steadyangle,topzoom,angle,easing,lastingtime){Note.call(this,time),this.transverse=transverse,this.bottomzoom=bottomzoom,this.linezoom=linezoom,this.steadyangle=steadyangle,this.topzoom=topzoom,this.angle=angle,this.easing=easing,this.lastingtime=Math.floor(lastingtime)}Note&&(Camera.__proto__=Note),(Camera.prototype=Object.create(Note&&Note.prototype)).constructor=Camera;var prototypeAccessors={easing:{configurable:!0}};return prototypeAccessors.easing.set=function(easingtype){if(-1==validstrings.cameraeasinglist.indexOf(easingtype))throw"invalid value "+easingtype+' for attribute "easing" (only accept '+validstrings.cameraeasinglist+")";this._easing=easingtype},prototypeAccessors.easing.get=function(){return this._easing},Camera.prototype.toString=function(){return"camera("+this.time+","+this.transverse.toFixed(2)+","+this.bottomzoom.toFixed(2)+","+this.linezoom.toFixed(2)+","+this.steadyangle.toFixed(2)+","+this.topzoom.toFixed(2)+","+this.angle.toFixed(2)+","+this.easing+","+this.lastingtime+");"},Object.defineProperties(Camera.prototype,prototypeAccessors),Camera}(Note),Flick=function(Note){function Flick(time,x,y,dx,dy){Note.call(this,time),this.x=x,this.y=y,this.dx=dx,this.dy=dy}return Note&&(Flick.__proto__=Note),((Flick.prototype=Object.create(Note&&Note.prototype)).constructor=Flick).prototype.toString=function(){return"flick("+Math.floor(this.time)+","+this.x.toFixed(2)+","+this.y.toFixed(2)+","+this.dx.toFixed(2)+","+this.dy.toFixed(2)+");"},Flick}(Note);function sort(unsorted){var sortable_timing=new NoteGroup,sortable_tap=new NoteGroup,sortable_hold=new NoteGroup,sortable_arc=new NoteGroup,sortable_camera=new NoteGroup,sortable_scene=new NoteGroup,sortable_group=new NoteGroup,sortedlist=new unsorted.constructor.prototype.constructor;return unsorted.forEach(function(eachnote){eachnote&&("Timing"==eachnote.type?sortable_timing.push(eachnote):"Tap"==eachnote.type?sortable_tap.push(eachnote):"Hold"==eachnote.type?sortable_hold.push(eachnote):"Arc"==eachnote.type?sortable_arc.push(eachnote):"Camera"==eachnote.type?sortable_camera.push(eachnote):"SceneControl"==eachnote.type?sortable_scene.push(eachnote):"TimingGroup"==eachnote.type&&eachnote instanceof NoteGroup&&sortable_group.push(sort(eachnote)))}),sortedlist.concat(sortBy$1(sortable_camera,["time"])),sortedlist.concat(sortBy$1(sortable_timing,["time"])),sortedlist.concat(sortBy$1(sortable_scene,["time"])),sortedlist.concat(sortBy$1(sortable_tap,["time","lane"])),sortedlist.concat(sortBy$1(sortable_hold,["time","lane","totime"])),sortedlist.concat(sortBy$1(sortable_arc,["time","fromx","fromy","totime","tox","toy"])),sortedlist.sort(function(a,b){return a.time-b.time}),sortedlist.concat(sortable_group),sortedlist}var AffList=function(NoteGroup){function AffList(notes,offset,desnity){void 0===offset&&(offset=0),void 0===desnity&&(desnity=1),NoteGroup.call(this,notes=void 0===notes?[]:notes),this.offset=Math.floor(offset),this.desnity=Math.floor(desnity)}return NoteGroup&&(AffList.__proto__=NoteGroup),((AffList.prototype=Object.create(NoteGroup&&NoteGroup.prototype)).constructor=AffList).prototype.toString=function(){var tsdfstring="";return 1!=this.desnity&&(tsdfstring="TimingPointDensityFactor:",this.desnity-Math.floor(this.desnity)==0?tsdfstring+=Math.floor(this.desnity).toString():tsdfstring+=this.desnity.toFixed(3)),["AudioOffset:"+Math.floor(this.offset),""==tsdfstring?"-":tsdfstring+"\n-",NoteGroup.prototype.toString.call(this)].join("\n")},AffList.prototype.offsetto=function(value){var this$1$1=this,basebpm=0;return this.forEach(function(each){each instanceof Timing&&0==each.time&&(basebpm=each.bpm)}),this.forEach(function(each,index){each&&this$1$1[index].offsetto(value)}),this.push(new Timing(0,basebpm,4)),sort(this)},AffList}(NoteGroup),TimingGroup=function(NoteGroup){function TimingGroup(notes,opt){void 0===opt&&(opt=""),NoteGroup.call(this,notes=void 0===notes?[]:notes),this.option=opt}return NoteGroup&&(TimingGroup.__proto__=NoteGroup),((TimingGroup.prototype=Object.create(NoteGroup&&NoteGroup.prototype)).constructor=TimingGroup).prototype.toString=function(){var group="timinggroup("+this.option+"){";return this.forEach(function(each){group+="\n"+each.toString()}),group+="\n};"},TimingGroup.prototype.push=function(){for(var this$1$1=this,objs=[],len=arguments.length;len--;)objs[len]=arguments[len];return objs.forEach(function(obj){NoteGroup.prototype.push.call(this$1$1,obj)}),this.length},TimingGroup.prototype.offsetto=function(value){var this$1$1=this,basebpm=0;return this.forEach(function(each){each instanceof Timing&&0==each.time&&(basebpm=each.bpm)}),this.forEach(function(each,index){each&&this$1$1[index].offsetto(value)}),this.push(new Timing(0,basebpm,4)),sort(this)},TimingGroup}(NoteGroup),freeSelf={Note:Note,NoteGroup:NoteGroup,timeAlign:timeAlign,Tap:Tap,Hold:Hold,Arc:Arc,Timing:Timing,SceneControl:SceneControl,Camera:Camera,Flick:Flick,TimingGroup:TimingGroup,AffList:AffList};function stringify(notelist){return(notelist=sort(notelist)).toString()}function _notestriter(notestr,termsign){return notestr.slice(0,notestr.indexOf(termsign))}function parseLine(notestr){var isskyline,notestr=notestr.trim(),noteobj=new Note(0),keyword=_notestriter(notestr,"("),parastr=_notestriter(notestr=notestr.slice(keyword.length+1,notestr.length),")"),paralist=parastr.split(","),parastr=_notestriter(notestr=notestr.slice(parastr.length+1,notestr.length),";");if(notestr=notestr.slice(keyword.length+1,notestr.length),""==keyword&&paralist)return new Tap(parseInt(paralist[0]),parseInt(paralist[1]));if("hold"==keyword)return new Hold(parseInt(paralist[0]),parseInt(paralist[1]),parseInt(paralist[2]));if("arc"==keyword){if("true"==paralist[9])isskyline=!0;else if(isskyline=!1,"false"!=paralist[9])throw"AffNoteValueError";var skynotetimelist=[];return parastr&&parastr.split(",").forEach(function(each){skynotetimelist.push(parseInt(each.slice(each.indexOf("(")+1,each.indexOf(")"))))}),new Arc(parseInt(paralist[0]),parseInt(paralist[1]),parseFloat(paralist[2]),parseFloat(paralist[3]),paralist[4],parseFloat(paralist[5]),parseFloat(paralist[6]),parseInt(paralist[7]),isskyline,skynotetimelist,paralist[8])}if("timing"==keyword)return new Timing(parseInt(paralist[0]),parseFloat(paralist[1]),parseFloat(paralist[2]));if("camera"==keyword)return new Camera(parseInt(paralist[0]),parseFloat(paralist[1]),parseFloat(paralist[2]),parseFloat(paralist[3]),parseFloat(paralist[4]),parseFloat(paralist[5]),parseFloat(paralist[6]),paralist[7],parseInt(paralist[8]));if("scenecontrol"!=keyword)return"flick"==keyword?new Flick(parseInt(paralist[0]),parseFloat(paralist[1]),parseFloat(paralist[2]),parseFloat(paralist[3]),parseFloat(paralist[4])):"timinggroup"==keyword?new TimingGroup([],paralist.join(",")):noteobj;notestr=paralist[1];if(-1!=["trackshow","trackhide"].indexOf(notestr))return new SceneControl(parseInt(paralist[0]),notestr);if(-1!=["redline","arcahvdistort","arcahvdebris","hidegroup"].indexOf(notestr))return new SceneControl(parseInt(paralist[0]),notestr,parseFloat(paralist[2]),parseInt(paralist[3]));throw"AffSceneTypeError"}function parse(affstr){var tempstruct,affstr=affstr.split("\n"),notelist=new AffList;return affstr.forEach(function(eachline){eachline=eachline.trim();if(-1==["","-"].indexOf(eachline))if(eachline.startsWith("AudioOffset:"))notelist.offset=parseInt(eachline.slice(eachline.indexOf(":")+1,eachline.length));else if(eachline.startsWith("TimingPointDensityFactor"))notelist.desnity=parseInt(eachline.slice(eachline.indexOf(":")+1,eachline.length));else if("};"==eachline)notelist.push(tempstruct),tempstruct=new TimingGroup;else{eachline=parseLine(eachline);if(eachline instanceof TimingGroup){if(0!=tempstruct.length)throw"Timinggroup nesting is not allowed";tempstruct=eachline}else(tempstruct||notelist).push(eachline)}}),notelist}freeGlobal$1={note:freeSelf,parser:{stringify:stringify,parseLine:parseLine,parse:parse},stringify:stringify,parseLine:parseLine,parse:parse};return Object.assign(freeGlobal$1,freeSelf),freeGlobal$1});
//# sourceMappingURL=affutil.min.js.map
